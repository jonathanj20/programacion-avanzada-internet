<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <canvas id="miCanvas">Canvas no está disponible para tu navegador</canvas>
    <style>
        #miCanvas {
            width: 600px;
            height: 600px;
            border: 2px solid #000;
            background: #EDEDED;
        }
    </style>
    <script>
        const canvas = document.getElementById('miCanvas');
        const ctx = canvas.getContext('2d');
        let x = 20, y = 20, dir = 0, w=20, h=10;
        let t_x = 50, t_y=50, t_w=10, t_h=5;
        let arregloMuros = [];

        class Rectagulo{
            constructor(posicionX, posicionY, ancho ,alto){
                this.posicionX = posicionX;
                this.posicionY = posicionY;
                this.ancho = ancho;
                this.alto = alto;
            }

            pintarRectangulo(){
                ctx.fillStyle = 'gray';
                ctx.fillRect(this.posicionX,this.posicionY,this.ancho,this.alto)
            }

            verificarColision(){
                let m_x = this.posicionX, m_y=this.posicionY, m_w=this.ancho, m_h=this.alto;

                if(x < m_x + m_w &&  x + w > m_x && y < m_y + m_h && y + h > m_y){
                    return true;
                } else {
                    return false;
                }
            }
        }

        const muro1 = new Rectagulo(70, 20, 160, 10);
        const muro2 = new Rectagulo(70, 110, 160, 10);

        arregloMuros.push(muro1);
        arregloMuros.push(muro2);

        console.log(arregloMuros);
        
        document.addEventListener("keydown", (e) => {
            switch (e.keyCode) {
                case 39:
                    dir = e.keyCode;
                    //derecha
                    break;
                case 37:
                    dir = e.keyCode;
                    //izquierda
                    break;
                case 38:
                    dir = e.keyCode;
                    //arriba
                    break;
                case 40:
                    dir = e.keyCode;
                    //abajo
                    break;
            }
        });

        function update() {
            switch (dir) {
                case 39:
                    x += 3;
                    if (x > 550) { x = -50; };
                    //derecha
                    break;
                case 37:
                    x -= 3;
                    if (x < -50) { x = 550; };
                    //izquierda
                    break;
                case 38:
                    y -= 3;
                    if (y < -50) { y = 550; };
                    //arriba
                    break;
                case 40:
                    y += 3;
                    if (y > 550) { y = -50; };
                    //abajo
                    break;
            }
            let tocanMuros = false;

            for (let i = 0; i < arregloMuros.length; i++) {
                if(arregloMuros[i].verificarColision()){
                    tocanMuros = true;
                } 
            }

            if(!tocanMuros){
                oldX = x;
                oldY = y;
            }

            repaint();
            window.requestAnimationFrame(update);
        }

        function repaint() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, 600, 600);
            ctx.fillStyle = getRandomColor();
            ctx.fillRect(x, y, w, h);
            ctx.strokeRect(x, y, w, h);

            muro1.pintarRectangulo();
            muro2.pintarRectangulo();

             for (let i = 0; i < arregloMuros.length; i++) {
                 if(arregloMuros[i].verificarColision()){
                    x=oldX;
                    y=oldY;
                    break;
                }
            }

            ctx.fillStyle = '#000';
            ctx.fillRect(t_x,t_y,t_w,t_h);

            if(x < t_x + t_w &&  x + w > t_x && y < t_y + t_h && y + h > t_y){ 
                t_x = Math.floor(Math.random() * (290 - 0 + 1) + 0);
                t_y = Math.floor(Math.random() * (145 - 0 + 1) + 0);
            }
        }

        function getRandomColor() {
            const r = Math.floor(Math.random() * 256); // Valor de rojo entre 0 y 255
            const g = Math.floor(Math.random() * 256); // Valor de verde entre 0 y 255
            const b = Math.floor(Math.random() * 256); // Valor de azul entre 0 y 255
            const alpha = 0.9; // Opacidad fija, ajusta este valor según lo que necesites

            return `rgba(${r},${g},${b},${alpha})`;
        }

        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
        }());

        window.requestAnimationFrame(update);

        function pintarCuadro(){
            ctx.fillStyle = '#000';
            ctx.fillRect(Math.floor(Math.random() * (290 - 0 + 1) + 0),Math.floor(Math.random() * (145 - 0 + 1) + 0),10,5);
        }
    </script>
</body>
</html>